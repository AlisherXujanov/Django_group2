{% extends 'base.html' %}
{% load static %}

{% block css %}
  <link rel="stylesheet" href="{% static 'styles/home.css' %}" />
{% endblock %}

{% block content %}
  <h1>{{ title }}</h1>

  <div class="todos-container">
    {% comment %} <a href="{% url 'create_todo' %}" class="btn btn-primary btn-sm float-end">Create todo</a> {% endcomment %}
    {% for item in todos %}
      <div class="todo-card" style="background-color: {{ item.background_color }}; color:{{ item.color }}">
        <div class="todo-title">
          <h2 class="card-title">{{ item.title|title }}</h2>
          <button type="button" class="btn btn-light todo-author-tooltip" style="background-color: {{ item.background_color }};">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ item.color }}" class="bi bi-person-circle" viewBox="0 0 16 16">
              <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0" />
              <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1" />
            </svg>
          </button>
        </div>
        <div class="todo-body">
          <p>{{ item.description }}</p>
        </div>
        <div class="todo-footer">
          <div class="deadline">
            <small>
              <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="{{ item.background_color }}" class="bi bi-hourglass-split" viewBox="0 0 16 16">
                <path d="M2.5 15a.5.5 0 1 1 0-1h1v-1a4.5 4.5 0 0 1 2.557-4.06c.29-.139.443-.377.443-.59v-.7c0-.213-.154-.451-.443-.59A4.5 4.5 0 0 1 3.5 3V2h-1a.5.5 0 0 1 0-1h11a.5.5 0 0 1 0 1h-1v1a4.5 4.5 0 0 1-2.557 4.06c-.29.139-.443.377-.443.59v.7c0 .213.154.451.443.59A4.5 4.5 0 0 1 12.5 13v1h1a.5.5 0 0 1 0 1zm2-13v1c0 .537.12 1.045.337 1.5h6.326c.216-.455.337-.963.337-1.5V2zm3 6.35c0 .701-.478 1.236-1.011 1.492A3.5 3.5 0 0 0 4.5 13s.866-1.299 3-1.48zm1 0v3.17c2.134.181 3 1.48 3 1.48a3.5 3.5 0 0 0-1.989-3.158C8.978 9.586 8.5 9.052 8.5 8.351z" />
              </svg>
              {{ item.deadline }}
            </small>
          </div>
          <div class="todo-action-buttons">
            <a href="{% url 'todo_details' item.id %}" class="btn btn-info">View</a>
            <a href="{% url 'update_todo' item.id %}" class="btn btn-warning">Update</a>
            <a href="#" class="btn btn-danger" onclick="handleDelete({{ item.id }})">Delete</a>
          </div>
        </div>
      </div>
    {% endfor %}

    <a href="{% url 'create_todo' %}"><div class="todo-card create-card-button">âž•</div></a>
  </div>
{% endblock %}

{% block script %}
  <script>
    function handleDelete(todoID) {
      Swal.fire({
        title: 'Are you sure?',
        text: "You won't be able to revert this!",
        icon: 'warning',
        showCancelButton: true,
        confirmButtonColor: '#3085d6',
        cancelButtonColor: '#dd333350',
        confirmButtonText: 'Yes, delete it!'
      }).then((result) => {
        if (result.isConfirmed) {
          Swal.fire({
            title: 'Deleted!',
            text: 'Your file has been deleted.',
            icon: 'success'
          })
          let URL = "{% url 'delete_todo_item' 9999999999 %}"
          setTimeout(() => {
            location.href = URL.replace('9999999999', todoID)
          }, 1000)
        }
      })
    }
  </script>
{% endblock %}
